version: "3.5"
services:
  
  redis:
    image: redis:alpine3.13
    container_name: redis
    restart: always
    ports:
        - "6379"
    networks:
        - phish_net
  
  rspamd:
    image: 6point6/rspamd:0.2
    container_name: rspamd
    volumes:
      - ./rspamd/lib/dkim:/var/lib/rspamd/dkim
    env_file:
      - 'settings.env'
    depends_on:
      - redis
    networks:
      - phish_net

  postfix:
    image: 6point6/postfix:0.2
    container_name: postfix
    env_file:
      - 'settings.env'
    depends_on:
      - rspamd
    ports:
      - "25"
    networks:
      - phish_net

  gophish:
    image: gophish/gophish:latest
    depends_on:
      - postfix
      - caddy
    networks:
      - phish_net
  # TODO: Build and upload image to dockerhub
  caddy:
    container_name: caddy
    env_file:
      - 'settings.env'
    build:  
        context: ./caddy 
    ports:
      - "80:80"
      - "443:443"
      - "3333:3333"
    networks:
      - phish_net

networks:
  phish_net:
    name: phish_net